<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
  <% for (let artwork of allArtworks) { %>
    <div class="col">
      <div class="card h-100 shadow-sm" style="border-radius: 15px;">

        <!-- Clickable image -->
        <a href="/artworks/<%= artwork._id %>">
          <img src="<%= artwork.image.url %>" 
               class="card-img-top" 
               alt="artwork_image" 
               style="border-top-left-radius: 15px; border-top-right-radius: 15px;" />
        </a>
        
        <div class="card-body">
          <h5 class="card-title">
            <a href="/artworks/<%= artwork._id %>" class="text-decoration-none text-dark">
              <%= artwork.title %>
            </a>
          </h5>
          <p class="card-text mb-1">Size: <%= artwork.size %></p>

          <!-- Description with read more -->
          <p class="card-text description mb-0" data-full="<%= artwork.description %>">
            <span class="short-text">
              <%= artwork.description.length > 100 
                   ? artwork.description.substring(0, 100) + "..." 
                   : artwork.description %>
            </span>
            <% if (artwork.description.length > 100) { %>
              <button type="button"
                      class="read-more btn btn-link p-0 m-0 align-baseline"
                      style="text-decoration: underline;">
                Read more
              </button>
            <% } %>
          </p>
        </div>

        <% if (currUser) { %>
        <div class="card-footer bg-transparent border-0 text-end">
          <form 
            action="/artworks/<%= artwork._id %>?_method=DELETE" 
            method="POST"
            style="display: inline-block;"
          >
            <button class="btn btn-dark btn-sm" onclick="return confirm('Are you sure you want to delete this artwork?')">
              Delete
            </button>
          </form>
        </div>
        <% } %>
      </div>
    </div>
  <% } %>
</div>

<!-- Script for Read More toggle -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.read-more').forEach(button => {
      button.addEventListener('click', function () {
        const descElement = this.closest('.description');
        const shortText = descElement?.querySelector('.short-text');
        const fullText = descElement?.dataset.full;

        if (!shortText || !fullText) return;

        if (this.textContent.trim() === 'Read more') {
          shortText.textContent = fullText;
          this.textContent = 'Read less';
        } else {
          shortText.textContent = fullText.substring(0, 100) + '...';
          this.textContent = 'Read more';
        }
      });
    });
  });
</script>
